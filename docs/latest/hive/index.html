<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Hive # Iceberg supports reading and writing Iceberg tables through Hive by using a StorageHandler.
Feature support # Iceberg compatibility with Hive 2.x and Hive 3.1.2/3 supports the following features:
Creating a table Dropping a table Reading a table Inserting into a table (INSERT INTO) DML operations work only with MapReduce execution engine. With Hive version 4.0.0-alpha-1 and above, the Iceberg integration when using HiveCatalog supports the following additional features:"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://iceberg.apache.org/docs/latest/hive/"><title>Hive | Apache Iceberg</title><link rel=manifest href=/docs/latest/manifest.json><link rel=icon href=/docs/latest/favicon.png type=image/x-icon><link rel=stylesheet href=/docs/latest/book.min.382d02a42babcef8e45d56616eebb5450770cf883b4185c7cbd5ecc4cb40920b.css integrity="sha256-OC0CpCurzvjkXVZhbuu1RQdwz4g7QYXHy9XsxMtAkgs=" crossorigin=anonymous><script defer src=/docs/latest/flexsearch.min.js></script>
<script defer src=/docs/latest/en.search.min.7790474a54256d75daa03489bec5b63b9d3487a1fdd263a5f6e4dd2fa2f761f2.js integrity="sha256-d5BHSlQlbXXaoDSJvsW2O500h6H90mOl9uTdL6L3YfI=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://iceberg.apache.org/docs/latest/hive/index.xml title="Apache Iceberg"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/docs/latest/../../><img src=/docs/latest/img/iceberg-logo-icon.png alt=Logo><span>Apache Iceberg</span></a>
<a href=https://iceberg.apache.org/docs/latest/../../releases><img id=version-shield src=https://img.shields.io/badge/version-0.13.2-blue alt></a></h2><div class=book-search><div class="book-search-spinner hidden"></div><a href=https://github.com/apache/iceberg target=_blank><img src=https://iceberg.apache.org/docs/latest/img/GitHub-Mark.png target=_blank class=top-external-icon></a>
<a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-tlv0zjz6-jGJEkHfb1~heMCJA3Uycrg target=_blank><img src=https://iceberg.apache.org/docs/latest/img/Slack_Mark_Web.png target=_blank class=top-external-icon></a></div><ul><li class=book-section-flats><span><i class="fa fa-table fa-fw"></i>
Tables</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/configuration/>Configuration</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/evolution/>Evolution</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/maintenance/>Maintenance</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/partitioning/>Partitioning</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/performance/>Performance</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/reliability/>Reliability</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/schemas/>Schemas</a></li></ul></li><li class=book-section-flats><span><i class="fa fa-star-o fa-fw"></i>
Spark</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/getting-started/>Getting Started</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-configuration/>Configuration</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-ddl/>DDL</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-procedures/>Procedures</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-queries/>Queries</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-structured-streaming/>Structured Streaming</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-writes/>Writes</a></li></ul></li><li class=book-section-flats><span><img src=https://iceberg.apache.org/docs/latest/img/flink-logo.png class="navigation-icon fa-fw">Flink</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/flink/>Getting Started</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/flink-connector/>Flink Connector</a></li></ul></li><li class=book-section-flats><a href=https://iceberg.apache.org/docs/latest/hive/ class=active><img src=https://iceberg.apache.org/docs/latest/img/../img/hive-logo.png class="navigation-icon fa-fw">Hive</a><ul></ul></li><li><a href=https://trino.io/docs/current/connector/iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/trino-logo.png class="navigation-icon fa-fw">
Trino</a></li><li><a href=https://prestodb.io/docs/current/connector/iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/prestodb-logo.png class="navigation-icon fa-fw">
Presto</a></li><li><a href=https://docs.dremio.com/data-formats/apache-iceberg/ target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/dremio-logo.png class="navigation-icon fa-fw">
Dremio</a></li><li><a href=https://docs.starrocks.com/en-us/main/using_starrocks/External_table#apache-iceberg-external-table target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/starrocks-logo.png class="navigation-icon fa-fw">
StarRocks</a></li><li><a href=https://docs.aws.amazon.com/athena/latest/ug/querying-iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/athena-logo.png class="navigation-icon fa-fw">
Amazon Athena</a></li><li><a href=https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-iceberg-use-cluster.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/emr-logo.png class="navigation-icon fa-fw">
Amazon EMR</a></li><li class=book-section-collapsed><input type=checkbox id=section-56605d8e971a871885e28ee5142728bf class=toggle>
<label for=section-56605d8e971a871885e28ee5142728bf class="flex justify-between"><a role=button><i class="fa fa-handshake-o fa-fw"></i>
Integrations</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/aws/>AWS</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/jdbc/>JDBC</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/nessie/>Nessie</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-bf7b3283e3790c00c8caaa140299052b class=toggle>
<label for=section-bf7b3283e3790c00c8caaa140299052b class="flex justify-between"><a role=button><i class="fa fa-connectdevelop fa-fw"></i>
API</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/java-api-quickstart/>Java Quickstart</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/api/>Java API</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/custom-catalog/>Java Custom Catalog</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../javadoc/latest>Javadocs</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/python-quickstart/>Python Quickstart</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/python-api-intro/>Python API</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/python-feature-support/>Python Feature Support</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-7e66f1754ca5d93e20ecdc89df5b8b28 class=toggle>
<label for=section-7e66f1754ca5d93e20ecdc89df5b8b28 class="flex justify-between"><a role=button><i class="fa fa-users fa-fw"></i>
Community</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../community>Join</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../blogs>Blogs</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../talks>Talks</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../contribute>Contribute</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-87dda23e9104fe3231cee3bc88a2d754 class=toggle>
<label for=section-87dda23e9104fe3231cee3bc88a2d754 class="flex justify-between"><a role=button><i class="fa fa-object-ungroup fa-fw"></i>
Format</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../spec>Spec</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../terms>Terms</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../view-spec>View Spec</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-2e5d3f5f142758d8dd368e9c281dd08e class=toggle>
<label for=section-2e5d3f5f142758d8dd368e9c281dd08e class="flex justify-between"><a role=button><i class="fa fa-wrench fa-fw"></i>
Project</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../how-to-release>How to Release</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../how-to-verify-a-release>How to Release</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../multi-engine-support>Multi-Engine Support</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../roadmap>Roadmap</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../security>Security</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../trademarks>Trademarks</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-4ddb27a8612bc8118c0b36386905d332 class=toggle>
<label for=section-4ddb27a8612bc8118c0b36386905d332 class="flex justify-between"><a role=button><i class="fa fa-code-fork fa-fw"></i>
Releases</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../latest>Latest</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.13.2>0.13.2</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.13.1>0.13.1</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.13.0>0.13.0</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.12.1>0.12.1</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../releases>Release Notes</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-296746d27808aa768e500824aaf2adea class=toggle>
<label for=section-296746d27808aa768e500824aaf2adea class="flex justify-between"><a role=button><img src=https://iceberg.apache.org/docs/latest/img/../img/asf.png class="navigation-icon fa-fw">ASF</a></label><ul><li class=navigation-icon-pad><a href=https://www.apache.org/licenses/ target=_blank><i class="fa fa-external-link fa-fw"></i>
License</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/security/ target=_blank><i class="fa fa-external-link fa-fw"></i>
Security</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/foundation/thanks.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Sponsors</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/foundation/sponsorship.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Donate</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/events/current-event.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Events</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/></div><div><ul id=book-search-results><li id=liFirst style=background-color:#0000;border-bottom:#0000;color:#0000>.</li></ul></div></br><header class=book-header><div class="flex align-center justify-between"><link rel=stylesheet href=/docs/latest/fontawesome/css/font-awesome.min.css><label for=menu-control><img src=/docs/latest/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Hive</strong>
<label for=toc-control><img src=/docs/latest/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#feature-support>Feature support</a></li><li><a href=#enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive</a><ul><li><a href=#hive-400-alpha-1>Hive 4.0.0-alpha-1</a></li><li><a href=#hive-23x-hive-31x>Hive 2.3.x, Hive 3.1.x</a></li></ul></li><li><a href=#catalog-management>Catalog Management</a><ul><li><a href=#global-hive-catalog>Global Hive catalog</a></li><li><a href=#custom-iceberg-catalogs>Custom Iceberg catalogs</a></li></ul></li><li><a href=#ddl-commands>DDL Commands</a><ul><li><a href=#create-table>CREATE TABLE</a></li><li><a href=#create-table-as-select>CREATE TABLE AS SELECT</a></li><li><a href=#create-external-table-overlaying-an-existing-iceberg-table>CREATE EXTERNAL TABLE overlaying an existing Iceberg table</a></li><li><a href=#alter-table>ALTER TABLE</a></li><li><a href=#truncate-table>TRUNCATE TABLE</a></li><li><a href=#drop-table>DROP TABLE</a></li></ul></li><li><a href=#dml-commands>DML Commands</a><ul><li><a href=#select>SELECT</a></li><li><a href=#insert-into>INSERT INTO</a></li><li><a href=#insert-overwrite>INSERT OVERWRITE</a></li><li><a href=#querying-metadata-tables>QUERYING METADATA TABLES</a></li><li><a href=#timetaravel>TIMETARAVEL</a></li></ul></li><li><a href=#type-compatibility>Type compatibility</a><ul><li><a href=#hive-type-to-iceberg-type>Hive type to Iceberg type</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=hive>Hive
<a class=anchor href=#hive>#</a></h1><p>Iceberg supports reading and writing Iceberg tables through <a href=https://hive.apache.org>Hive</a> by using a <a href=https://cwiki.apache.org/confluence/display/Hive/StorageHandlers>StorageHandler</a>.</p><h2 id=feature-support>Feature support
<a class=anchor href=#feature-support>#</a></h2><p>Iceberg compatibility with Hive 2.x and Hive 3.1.2/3 supports the following features:</p><ul><li>Creating a table</li><li>Dropping a table</li><li>Reading a table</li><li>Inserting into a table (INSERT INTO)</li></ul><blockquote class="book-hint warning">DML operations work only with MapReduce execution engine.</blockquote><p>With Hive version 4.0.0-alpha-1 and above,
the Iceberg integration when using HiveCatalog supports the following additional features:</p><ul><li>Creating an Iceberg identity-partitioned table</li><li>Creating an Iceberg table with any partition spec, including the various transforms supported by Iceberg</li><li>Creating a table from an existing table (CTAS table)</li><li>Altering a table while keeping Iceberg and Hive schemas in sync</li><li>Altering the partition schema (updating columns)</li><li>Altering the partition schema by specifying partition transforms</li><li>Truncating a table</li><li>Migrating tables in Avro, Parquet, or ORC (Non-ACID) format to Iceberg</li><li>Reading the schema of a table</li><li>Querying Iceberg metadata tables</li><li>Time travel applications</li><li>Inserting into a table (INSERT INTO)</li><li>Inserting data overwriting existing data (INSERT OVERWRITE)</li></ul><blockquote class="book-hint warning">DML operations work only with Tez execution engine.</blockquote><h2 id=enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive
<a class=anchor href=#enabling-iceberg-support-in-hive>#</a></h2><h3 id=hive-400-alpha-1>Hive 4.0.0-alpha-1
<a class=anchor href=#hive-400-alpha-1>#</a></h3><p>Hive 4.0.0-alpha-1 comes with the Iceberg 0.13.1 included. No additional downloads or jars are needed.</p><h3 id=hive-23x-hive-31x>Hive 2.3.x, Hive 3.1.x
<a class=anchor href=#hive-23x-hive-31x>#</a></h3><p>You need to do the following steps:</p><ul><li>Loading runtime jar</li><li>Enabling support</li></ul><h4 id=loading-runtime-jar>Loading runtime jar
<a class=anchor href=#loading-runtime-jar>#</a></h4><p>To enable Iceberg support in Hive, the <code>HiveIcebergStorageHandler</code> and supporting classes need to be made available on Hive&rsquo;s classpath.
These are provided by the <code>iceberg-hive-runtime</code> jar file.
For example, if using the Hive shell, this can be achieved by issuing a statement like so:</p><pre tabindex=0><code>add jar /path/to/iceberg-hive-runtime.jar;
</code></pre><p>There are many others ways to achieve this including adding the jar file to Hive&rsquo;s auxiliary classpath so it is available by default.
Please refer to Hive&rsquo;s documentation for more information.</p><h4 id=enabling-support>Enabling support
<a class=anchor href=#enabling-support>#</a></h4><p>If the Iceberg storage handler is not in Hive&rsquo;s classpath, then Hive cannot load or update the metadata for an Iceberg table when the storage handler is set.
To avoid the appearance of broken tables in Hive, Iceberg will not add the storage handler to a table unless Hive support is enabled.
The storage handler is kept in sync (added or removed) every time Hive engine support for the table is updated, i.e. turned on or off in the table properties.
There are two ways to enable Hive support: globally in Hadoop Configuration and per-table using a table property.</p><h5 id=hadoop-configuration>Hadoop configuration
<a class=anchor href=#hadoop-configuration>#</a></h5><p>To enable Hive support globally for an application, set <code>iceberg.engine.hive.enabled=true</code> in its Hadoop configuration.
For example, setting this in the <code>hive-site.xml</code> loaded by Spark will enable the storage handler for all tables created by Spark.</p><blockquote class="book-hint danger">Starting with Apache Iceberg <code>0.11.0</code>, when using Hive with Tez you also have to disable vectorization (<code>hive.vectorized.execution.enabled=false</code>).</blockquote><h5 id=table-property-configuration>Table property configuration
<a class=anchor href=#table-property-configuration>#</a></h5><p>Alternatively, the property <code>engine.hive.enabled</code> can be set to <code>true</code> and added to the table properties when creating the Iceberg table.
Here is an example of doing it programmatically:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Catalog catalog <span style=color:#f92672>=</span> <span style=color:#f92672>...;</span>
</span></span><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> tableProperties <span style=color:#f92672>=</span> Maps<span style=color:#f92672>.</span><span style=color:#a6e22e>newHashMap</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>tableProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>TableProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>ENGINE_HIVE_ENABLED</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>);</span> <span style=color:#75715e>// engine.hive.enabled=true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>catalog<span style=color:#f92672>.</span><span style=color:#a6e22e>createTable</span><span style=color:#f92672>(</span>tableId<span style=color:#f92672>,</span> schema<span style=color:#f92672>,</span> spec<span style=color:#f92672>,</span> tableProperties<span style=color:#f92672>);</span>
</span></span></code></pre></div><p>The table level configuration overrides the global Hadoop configuration.</p><h5 id=hive-on-tez-configuration>Hive on Tez configuration
<a class=anchor href=#hive-on-tez-configuration>#</a></h5><p>To use the Tez engine on Hive <code>3.1.2</code> or later, Tez needs to be upgraded to >= <code>0.10.1</code> which contains a necessary fix <a href=https://issues.apache.org/jira/browse/TEZ-4248>TEZ-4248</a>.</p><p>To use the Tez engine on Hive <code>2.3.x</code>, you will need to manually build Tez from the <code>branch-0.9</code> branch due to a backwards incompatibility issue with Tez <code>0.10.1</code>.</p><p>You will also need to set the following property in the Hive configuration: <code>tez.mrreader.config.update.properties=hive.io.file.readcolumn.names,hive.io.file.readcolumn.ids</code>.</p><h2 id=catalog-management>Catalog Management
<a class=anchor href=#catalog-management>#</a></h2><h3 id=global-hive-catalog>Global Hive catalog
<a class=anchor href=#global-hive-catalog>#</a></h3><p>From the Hive engine&rsquo;s perspective, there is only one global data catalog that is defined in the Hadoop configuration in the runtime environment.
In contrast, Iceberg supports multiple different data catalog types such as Hive, Hadoop, AWS Glue, or custom catalog implementations.
Iceberg also allows loading a table directly based on its path in the file system. Those tables do not belong to any catalog.
Users might want to read these cross-catalog and path-based tables through the Hive engine for use cases like join.</p><p>To support this, a table in the Hive metastore can represent three different ways of loading an Iceberg table,
depending on the table&rsquo;s <code>iceberg.catalog</code> property:</p><ol><li>The table will be loaded using a <code>HiveCatalog</code> that corresponds to the metastore configured in the Hive environment if no <code>iceberg.catalog</code> is set</li><li>The table will be loaded using a custom catalog if <code>iceberg.catalog</code> is set to a catalog name (see below)</li><li>The table can be loaded directly using the table&rsquo;s root location if <code>iceberg.catalog</code> is set to <code>location_based_table</code></li></ol><p>For cases 2 and 3 above, users can create an overlay of an Iceberg table in the Hive metastore,
so that different table types can work together in the same Hive environment.
See <a href=#create-external-table>CREATE EXTERNAL TABLE</a> and <a href=#create-table>CREATE TABLE</a> for more details.</p><h3 id=custom-iceberg-catalogs>Custom Iceberg catalogs
<a class=anchor href=#custom-iceberg-catalogs>#</a></h3><p>To globally register different catalogs, set the following Hadoop configurations:</p><table><thead><tr><th>Config Key</th><th>Description</th></tr></thead><tbody><tr><td>iceberg.catalog.&lt;catalog_name>.type</td><td>type of catalog: <code>hive</code>, <code>hadoop</code>, or left unset if using a custom catalog</td></tr><tr><td>iceberg.catalog.&lt;catalog_name>.catalog-impl</td><td>catalog implementation, must not be null if type is empty</td></tr><tr><td>iceberg.catalog.&lt;catalog_name>.&lt;key></td><td>any config key and value pairs for the catalog</td></tr></tbody></table><p>Here are some examples using Hive CLI:</p><p>Register a <code>HiveCatalog</code> called <code>another_hive</code>:</p><pre tabindex=0><code>SET iceberg.catalog.another_hive.type=hive;
SET iceberg.catalog.another_hive.uri=thrift://example.com:9083;
SET iceberg.catalog.another_hive.clients=10;
SET iceberg.catalog.another_hive.warehouse=hdfs://example.com:8020/warehouse;
</code></pre><p>Register a <code>HadoopCatalog</code> called <code>hadoop</code>:</p><pre tabindex=0><code>SET iceberg.catalog.hadoop.type=hadoop;
SET iceberg.catalog.hadoop.warehouse=hdfs://example.com:8020/warehouse;
</code></pre><p>Register an AWS <code>GlueCatalog</code> called <code>glue</code>:</p><pre tabindex=0><code>SET iceberg.catalog.glue.catalog-impl=org.apache.iceberg.aws.GlueCatalog;
SET iceberg.catalog.glue.warehouse=s3://my-bucket/my/key/prefix;
SET iceberg.catalog.glue.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager;
SET iceberg.catalog.glue.lock.table=myGlueLockTable;
</code></pre><h2 id=ddl-commands>DDL Commands
<a class=anchor href=#ddl-commands>#</a></h2><p>Not all the features below are supported with Hive 2.3.x and Hive 3.1.x. Please refer to the
<a href=#feature-support>Feature support</a> paragraph for further details.</p><p>One generally applicable difference is that Hive 4.0.0-alpha-1 provides the possibility to use
<code>STORED BY ICEBERG</code> instead of the old <code>STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler'</code></p><h3 id=create-table>CREATE TABLE
<a class=anchor href=#create-table>#</a></h3><h4 id=non-partitioned-tables>Non partitioned tables
<a class=anchor href=#non-partitioned-tables>#</a></h4><p>The Hive <code>CREATE EXTERNAL TABLE</code> command creates an Iceberg table when you specify the storage handler as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> x (i int) STORED <span style=color:#66d9ef>BY</span> ICEBERG;
</span></span></code></pre></div><p>If you want to create external tables using CREATE TABLE, configure the MetaStoreMetadataTransformer on the cluster,
and <code>CREATE TABLE</code> commands are transformed to create external tables. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> x (i int) STORED <span style=color:#66d9ef>BY</span> ICEBERG;
</span></span></code></pre></div><p>You can specify the default file format (Avro, Parquet, ORC) at the time of the table creation.
The default is Parquet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> x (i int) STORED <span style=color:#66d9ef>BY</span> ICEBERG STORED <span style=color:#66d9ef>AS</span> ORC;
</span></span></code></pre></div><h4 id=partitioned-tables>Partitioned tables
<a class=anchor href=#partitioned-tables>#</a></h4><p>You can create Iceberg partitioned tables using a command familiar to those who create non-Iceberg tables:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> x (i int) PARTITIONED <span style=color:#66d9ef>BY</span> (j int) STORED <span style=color:#66d9ef>BY</span> ICEBERG;
</span></span></code></pre></div><blockquote class="book-hint info">The resulting table does not create partitions in HMS, but instead, converts partition data into Iceberg identity partitions.</blockquote><p>Use the DESCRIBE command to get information about the Iceberg identity partitions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>DESCRIBE</span> x;
</span></span></code></pre></div><p>The result is:</p><table><thead><tr><th>col_name</th><th>data_type</th><th>comment</th></tr></thead><tbody><tr><td>i</td><td>int</td><td></td></tr><tr><td>j</td><td>int</td><td></td></tr><tr><td></td><td>NULL</td><td>NULL</td></tr><tr><td># Partition Transform Information</td><td>NULL</td><td>NULL</td></tr><tr><td># col_name</td><td>transform_type</td><td>NULL</td></tr><tr><td>j</td><td>IDENTITY</td><td>NULL</td></tr></tbody></table><p>You can create Iceberg partitions using the following Iceberg partition specification syntax
(supported only in Hive 4.0.0-alpha-1):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> x (i int, ts <span style=color:#66d9ef>timestamp</span>) PARTITIONED <span style=color:#66d9ef>BY</span> SPEC (<span style=color:#66d9ef>month</span>(ts), bucket(<span style=color:#ae81ff>2</span>, i)) STORED <span style=color:#66d9ef>AS</span> ICEBERG;
</span></span><span style=display:flex><span><span style=color:#66d9ef>DESCRIBE</span> x;
</span></span></code></pre></div><p>The result is:</p><table><thead><tr><th>col_name</th><th>data_type</th><th>comment</th></tr></thead><tbody><tr><td>i</td><td>int</td><td></td></tr><tr><td>ts</td><td>timestamp</td><td></td></tr><tr><td></td><td>NULL</td><td>NULL</td></tr><tr><td># Partition Transform Information</td><td>NULL</td><td>NULL</td></tr><tr><td># col_name</td><td>transform_type</td><td>NULL</td></tr><tr><td>ts</td><td>MONTH</td><td>NULL</td></tr><tr><td>i</td><td>BUCKET[2]</td><td>NULL</td></tr></tbody></table><p>The supported transformations for Hive are the same as for Spark:</p><ul><li>years(ts): partition by year</li><li>months(ts): partition by month</li><li>days(ts) or date(ts): equivalent to dateint partitioning</li><li>hours(ts) or date_hour(ts): equivalent to dateint and hour partitioning</li><li>bucket(N, col): partition by hashed value mod N buckets</li><li>truncate(L, col): partition by value truncated to L<ul><li>Strings are truncated to the given length</li><li>Integers and longs truncate to bins: truncate(10, i) produces partitions 0, 10, 20, 30,</li></ul></li></ul><blockquote class="book-hint info">The resulting table does not create partitions in HMS, but instead, converts partition data into Iceberg partitions.</blockquote><h3 id=create-table-as-select>CREATE TABLE AS SELECT
<a class=anchor href=#create-table-as-select>#</a></h3><p><code>CREATE TABLE AS SELECT</code> operation resembles the native Hive operation with a single important difference.
The Iceberg table and the corresponding Hive table are created at the beginning of the query execution.
The data is inserted / committed when the query finishes. So for a transient period the table already exists but contains no data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> target PARTITIONED <span style=color:#66d9ef>BY</span> SPEC (<span style=color:#66d9ef>year</span>(year_field), identity_field) STORED <span style=color:#66d9ef>BY</span> ICEBERG <span style=color:#66d9ef>AS</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>source</span>;
</span></span></code></pre></div><h3 id=create-external-table-overlaying-an-existing-iceberg-table>CREATE EXTERNAL TABLE overlaying an existing Iceberg table
<a class=anchor href=#create-external-table-overlaying-an-existing-iceberg-table>#</a></h3><p>The <code>CREATE EXTERNAL TABLE</code> command is used to overlay a Hive table &ldquo;on top of&rdquo; an existing Iceberg table.
Iceberg tables are created using either a <a href=../../../javadoc/0.13.2/index.html?org/apache/iceberg/catalog/Catalog.html><code>Catalog</code></a>,
or an implementation of the <a href=../../../javadoc/0.13.2/index.html?org/apache/iceberg/Tables.html><code>Tables</code></a> interface,
and Hive needs to be configured accordingly to operate on these different types of table.</p><h4 id=hive-catalog-tables>Hive catalog tables
<a class=anchor href=#hive-catalog-tables>#</a></h4><p>As described before, tables created by the <code>HiveCatalog</code> with Hive engine feature enabled are directly visible by the Hive engine, so there is no need to create an overlay.</p><h4 id=custom-catalog-tables>Custom catalog tables
<a class=anchor href=#custom-catalog-tables>#</a></h4><p>For a table in a registered catalog, specify the catalog name in the statement using table property <code>iceberg.catalog</code>.
For example, the SQL below creates an overlay for a table in a <code>hadoop</code> type catalog named <code>hadoop_cat</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.<span style=color:#66d9ef>type</span><span style=color:#f92672>=</span>hadoop;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.warehouse<span style=color:#f92672>=</span>hdfs:<span style=color:#f92672>//</span>example.com:<span style=color:#ae81ff>8020</span><span style=color:#f92672>/</span>hadoop_cat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a
</span></span><span style=display:flex><span>STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
</span></span><span style=display:flex><span>TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hadoop_cat&#39;</span>);
</span></span></code></pre></div><p>When <code>iceberg.catalog</code> is missing from both table properties and the global Hadoop configuration, <code>HiveCatalog</code> will be used as default.</p><h4 id=path-based-hadoop-tables>Path-based Hadoop tables
<a class=anchor href=#path-based-hadoop-tables>#</a></h4><p>Iceberg tables created using <code>HadoopTables</code> are stored entirely in a directory in a filesystem like HDFS.
These tables are considered to have no catalog.
To indicate that, set <code>iceberg.catalog</code> property to <code>location_based_table</code>. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> table_a 
</span></span><span style=display:flex><span>STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>LOCATION</span> <span style=color:#e6db74>&#39;hdfs://some_bucket/some_path/table_a&#39;</span>
</span></span><span style=display:flex><span>TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;location_based_table&#39;</span>);
</span></span></code></pre></div><h4 id=create-table-overlaying-an-existing-iceberg-table>CREATE TABLE overlaying an existing Iceberg table
<a class=anchor href=#create-table-overlaying-an-existing-iceberg-table>#</a></h4><p>You can also create a new table that is managed by a custom catalog.
For example, the following code creates a table in a custom Hadoop catalog:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.<span style=color:#66d9ef>type</span><span style=color:#f92672>=</span>hadoop;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.warehouse<span style=color:#f92672>=</span>hdfs:<span style=color:#f92672>//</span>example.com:<span style=color:#ae81ff>8020</span><span style=color:#f92672>/</span>hadoop_cat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a (
</span></span><span style=display:flex><span>  id bigint, name string
</span></span><span style=display:flex><span>) PARTITIONED <span style=color:#66d9ef>BY</span> (
</span></span><span style=display:flex><span>  dept string
</span></span><span style=display:flex><span>) STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
</span></span><span style=display:flex><span>TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hadoop_cat&#39;</span>);
</span></span></code></pre></div><blockquote class="book-hint danger">If the table to create already exists in the custom catalog, this will create a managed overlay table.
This means technically you can omit the <code>EXTERNAL</code> keyword when creating an overlay table.
However, this is <strong>not recommended</strong> because creating managed overlay tables could pose a risk
to the shared data files in case of accidental drop table commands from the Hive side,
which would unintentionally remove all the data in the table.</blockquote><h3 id=alter-table>ALTER TABLE
<a class=anchor href=#alter-table>#</a></h3><h4 id=table-properties>Table properties
<a class=anchor href=#table-properties>#</a></h4><p>For HiveCatalog tables the Iceberg table properties and the Hive table properties stored in HMS are kept in sync.</p><blockquote class="book-hint info">IMPORTANT: This feature is not available for other Catalog implementations.</blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> t <span style=color:#66d9ef>SET</span> TBLPROPERTIES(<span style=color:#e6db74>&#39;...&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;...&#39;</span>);
</span></span></code></pre></div><h4 id=schema-evolution>Schema evolution
<a class=anchor href=#schema-evolution>#</a></h4><p>The Hive table schema is kept in sync with the Iceberg table. If an outside source (Impala/Spark/Java API/etc)
changes the schema, the Hive table immediately reflects the changes. You alter the table schema using Hive commands:</p><ul><li>Add a column</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orders <span style=color:#66d9ef>ADD</span> COLUMNS (nickname string);
</span></span></code></pre></div><ul><li>Rename a column</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orders CHANGE <span style=color:#66d9ef>COLUMN</span> item fruit string;
</span></span></code></pre></div><ul><li>Reorder columns</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orders CHANGE <span style=color:#66d9ef>COLUMN</span> quantity quantity int <span style=color:#66d9ef>AFTER</span> price;
</span></span></code></pre></div><ul><li>Change a column type - only if the Iceberg defined the column type change as safe</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orders CHANGE <span style=color:#66d9ef>COLUMN</span> price price long;
</span></span></code></pre></div><ul><li>Drop column by using REPLACE COLUMN to remove the old column</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> orders <span style=color:#66d9ef>REPLACE</span> COLUMNS (remaining string);
</span></span></code></pre></div><blockquote class="book-hint info">Note, that dropping columns is only thing REPLACE COLUMNS can be used for
i.e. if columns are specified out-of-order an error will be thrown signalling this limitation.</blockquote><h4 id=partition-evolution>Partition evolution
<a class=anchor href=#partition-evolution>#</a></h4><p>You change the partitioning schema using the following commands:</p><ul><li>Change the partitioning schema to new identity partitions:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>default</span>.customers <span style=color:#66d9ef>SET</span> PARTITION SPEC (last_name);
</span></span></code></pre></div><ul><li>Alternatively, provide a partition specification:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>order</span> <span style=color:#66d9ef>SET</span> PARTITION SPEC (<span style=color:#66d9ef>month</span>(ts));
</span></span></code></pre></div><h4 id=table-migration>Table migration
<a class=anchor href=#table-migration>#</a></h4><p>You can migrate Avro / Parquet / ORC external tables to Iceberg tables using the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>TABLE</span> t <span style=color:#66d9ef>SET</span> TBLPROPERTIES (<span style=color:#e6db74>&#39;storage_handler&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>);
</span></span></code></pre></div><p>During the migration the data files are not changed, only the appropriate Iceberg metadata files are created.
After the migration, handle the table as a normal Iceberg table.</p><h3 id=truncate-table>TRUNCATE TABLE
<a class=anchor href=#truncate-table>#</a></h3><p>The following command truncates the Iceberg table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>TRUNCATE</span> <span style=color:#66d9ef>TABLE</span> t;
</span></span></code></pre></div><p>Using a partition specification is not allowed.</p><h3 id=drop-table>DROP TABLE
<a class=anchor href=#drop-table>#</a></h3><p>Tables can be dropped using the <code>DROP TABLE</code> command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> [<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span>] <span style=color:#66d9ef>table_name</span> [PURGE];
</span></span></code></pre></div><h2 id=dml-commands>DML Commands
<a class=anchor href=#dml-commands>#</a></h2><h3 id=select>SELECT
<a class=anchor href=#select>#</a></h3><p>Select statements work the same on Iceberg tables in Hive. You will see the Iceberg benefits over Hive in compilation and execution:</p><ul><li><strong>No file system listings</strong> - especially important on blob stores, like S3</li><li><strong>No partition listing from</strong> the Metastore</li><li><strong>Advanced partition filtering</strong> - the partition keys are not needed in the queries when they could be calculated</li><li>Could handle <strong>higher number of partitions</strong> than normal Hive tables</li></ul><p>Here are the features highlights for Iceberg Hive read support:</p><ol><li><strong>Predicate pushdown</strong>: Pushdown of the Hive SQL <code>WHERE</code> clause has been implemented so that these filters are used at the Iceberg <code>TableScan</code> level as well as by the Parquet and ORC Readers.</li><li><strong>Column projection</strong>: Columns from the Hive SQL <code>SELECT</code> clause are projected down to the Iceberg readers to reduce the number of columns read.</li><li><strong>Hive query engines</strong>:<ul><li>With Hive 2.3.x, 3.1.x both the MapReduce and Tez query execution engines are supported.</li><li>With Hive 4.0.0-alpha-1 Tez query execution engine is supported.</li></ul></li></ol><p>Some of the advanced / little used optimizations are not yet implemented for Iceberg tables, so you should check your individual queries.
Also currently the statistics stored in the MetaStore are used for query planning. This is something we are planning to improve in the future.</p><h3 id=insert-into>INSERT INTO
<a class=anchor href=#insert-into>#</a></h3><p>Hive supports the standard single-table INSERT INTO operation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> table_a <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> table_a <span style=color:#66d9ef>SELECT</span> ...;
</span></span></code></pre></div><p>Multi-table insert is also supported, but it will not be atomic. Commits occur one table at a time.
Partial changes will be visible during the commit process and failures can leave partial changes committed.
Changes within a single table will remain atomic.</p><p>Here is an example of inserting into multiple tables at once in Hive SQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>FROM</span> customers
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> target1 <span style=color:#66d9ef>SELECT</span> customer_id, first_name
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> target2 <span style=color:#66d9ef>SELECT</span> last_name, customer_id;
</span></span></code></pre></div><h3 id=insert-overwrite>INSERT OVERWRITE
<a class=anchor href=#insert-overwrite>#</a></h3><p>INSERT OVERWRITE can replace data in the table with the result of a query. Overwrites are atomic operations for Iceberg tables.
For nonpartitioned tables the content of the table is always removed. For partitioned tables the partitions
that have rows produced by the SELECT query will be replaced.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> OVERWRITE <span style=color:#66d9ef>TABLE</span> target <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>source</span>;
</span></span></code></pre></div><h3 id=querying-metadata-tables>QUERYING METADATA TABLES
<a class=anchor href=#querying-metadata-tables>#</a></h3><p>Hive supports querying of the Iceberg Metadata tables. The tables could be used as normal
Hive tables, so it is possible to use projections / joins / filters / etc.
To reference a metadata table the full name of the table should be used, like:
&lt;DB_NAME>.&lt;TABLE_NAME>.&lt;METADATA_TABLE_NAME>.</p><p>Currently the following metadata tables are available in Hive:</p><ul><li>files</li><li>entries</li><li>snapshots</li><li>manifests</li><li>partitions</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>default</span>.table_a.files;
</span></span></code></pre></div><h3 id=timetaravel>TIMETARAVEL
<a class=anchor href=#timetaravel>#</a></h3><p>Hive supports snapshot id based and time base timetravel queries.
For these views it is possible to use projections / joins / filters / etc.
The function is available with the following syntax:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> table_a <span style=color:#66d9ef>FOR</span> SYSTEM_TIME <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#e6db74>&#39;2021-08-09 10:35:57&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> table_a <span style=color:#66d9ef>FOR</span> SYSTEM_VERSION <span style=color:#66d9ef>AS</span> <span style=color:#66d9ef>OF</span> <span style=color:#ae81ff>1234567</span>;
</span></span></code></pre></div><h2 id=type-compatibility>Type compatibility
<a class=anchor href=#type-compatibility>#</a></h2><p>Hive and Iceberg support different set of types. Iceberg can perform type conversion automatically, but not for all combinations,
so you may want to understand the type conversion in Iceberg in prior to design the types of columns in your tables.
You can enable auto-conversion through Hadoop configuration (not enabled by default):</p><table><thead><tr><th>Config key</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>iceberg.mr.schema.auto.conversion</td><td>false</td><td>if Hive should perform type auto-conversion</td></tr></tbody></table><h3 id=hive-type-to-iceberg-type>Hive type to Iceberg type
<a class=anchor href=#hive-type-to-iceberg-type>#</a></h3><p>This type conversion table describes how Hive types are converted to the Iceberg types.
The conversion applies on both creating Iceberg table and writing to Iceberg table via Hive.</p><table><thead><tr><th>Hive</th><th>Iceberg</th><th>Notes</th></tr></thead><tbody><tr><td>boolean</td><td>boolean</td><td></td></tr><tr><td>short</td><td>integer</td><td>auto-conversion</td></tr><tr><td>byte</td><td>integer</td><td>auto-conversion</td></tr><tr><td>integer</td><td>integer</td><td></td></tr><tr><td>long</td><td>long</td><td></td></tr><tr><td>float</td><td>float</td><td></td></tr><tr><td>double</td><td>double</td><td></td></tr><tr><td>date</td><td>date</td><td></td></tr><tr><td>timestamp</td><td>timestamp without timezone</td><td></td></tr><tr><td>timestamplocaltz</td><td>timestamp with timezone</td><td>Hive 3 only</td></tr><tr><td>interval_year_month</td><td></td><td>not supported</td></tr><tr><td>interval_day_time</td><td></td><td>not supported</td></tr><tr><td>char</td><td>string</td><td>auto-conversion</td></tr><tr><td>varchar</td><td>string</td><td>auto-conversion</td></tr><tr><td>string</td><td>string</td><td></td></tr><tr><td>binary</td><td>binary</td><td></td></tr><tr><td>decimal</td><td>decimal</td><td></td></tr><tr><td>struct</td><td>struct</td><td></td></tr><tr><td>list</td><td>list</td><td></td></tr><tr><td>map</td><td>map</td><td></td></tr><tr><td>union</td><td></td><td>not supported</td></tr></tbody></table></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#feature-support>Feature support</a></li><li><a href=#enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive</a><ul><li><a href=#hive-400-alpha-1>Hive 4.0.0-alpha-1</a></li><li><a href=#hive-23x-hive-31x>Hive 2.3.x, Hive 3.1.x</a></li></ul></li><li><a href=#catalog-management>Catalog Management</a><ul><li><a href=#global-hive-catalog>Global Hive catalog</a></li><li><a href=#custom-iceberg-catalogs>Custom Iceberg catalogs</a></li></ul></li><li><a href=#ddl-commands>DDL Commands</a><ul><li><a href=#create-table>CREATE TABLE</a></li><li><a href=#create-table-as-select>CREATE TABLE AS SELECT</a></li><li><a href=#create-external-table-overlaying-an-existing-iceberg-table>CREATE EXTERNAL TABLE overlaying an existing Iceberg table</a></li><li><a href=#alter-table>ALTER TABLE</a></li><li><a href=#truncate-table>TRUNCATE TABLE</a></li><li><a href=#drop-table>DROP TABLE</a></li></ul></li><li><a href=#dml-commands>DML Commands</a><ul><li><a href=#select>SELECT</a></li><li><a href=#insert-into>INSERT INTO</a></li><li><a href=#insert-overwrite>INSERT OVERWRITE</a></li><li><a href=#querying-metadata-tables>QUERYING METADATA TABLES</a></li><li><a href=#timetaravel>TIMETARAVEL</a></li></ul></li><li><a href=#type-compatibility>Type compatibility</a><ul><li><a href=#hive-type-to-iceberg-type>Hive type to Iceberg type</a></li></ul></li></ul></nav></div></aside></main></body></html>
<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Reliability # Iceberg was designed to solve correctness problems that affect Hive tables running in S3.
Hive tables track data files using both a central metastore for partitions and a file system for individual files. This makes atomic changes to a table&rsquo;s contents impossible, and eventually consistent stores like S3 may return incorrect results due to the use of listing files to reconstruct the state of a table. It also requires job planning to make many slow listing calls: O(n) with the number of partitions."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Reliability # Iceberg was designed to solve correctness problems that affect Hive tables running in S3.
Hive tables track data files using both a central metastore for partitions and a file system for individual files. This makes atomic changes to a table&rsquo;s contents impossible, and eventually consistent stores like S3 may return incorrect results due to the use of listing files to reconstruct the state of a table. It also requires job planning to make many slow listing calls: O(n) with the number of partitions."><meta property="og:type" content="article"><meta property="og:url" content="https://iceberg.apache.org/docs/latest/reliability/"><meta property="article:section" content="docs"><title>Reliability | Apache Iceberg</title><link rel=manifest href=/docs/latest/manifest.json><link rel=icon href=/docs/latest/favicon.png type=image/x-icon><link rel=stylesheet href=/docs/latest/book.min.382d02a42babcef8e45d56616eebb5450770cf883b4185c7cbd5ecc4cb40920b.css integrity="sha256-OC0CpCurzvjkXVZhbuu1RQdwz4g7QYXHy9XsxMtAkgs=" crossorigin=anonymous><script defer src=/docs/latest/flexsearch.min.js></script>
<script defer src=/docs/latest/en.search.min.102c5ce90fd09c70d10dd45fdac410afc4748e7342bba625902549e1cf8153ce.js integrity="sha256-ECxc6Q/QnHDRDdRf2sQQr8R0jnNCu6YlkCVJ4c+BU84=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/docs/latest/../../><img src=/docs/latest/img/iceberg-logo-icon.png alt=Logo><span>Apache Iceberg</span></a>
<a href=https://iceberg.apache.org/docs/latest/../../releases><img id=version-shield src=https://img.shields.io/badge/version-0.13.1-blue alt></a></h2><div class=book-search><div class="book-search-spinner hidden"></div><a href=https://github.com/apache/iceberg target=_blank><img src=https://iceberg.apache.org/docs/latest/img/GitHub-Mark.png target=_blank class=top-external-icon></a>
<a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-tlv0zjz6-jGJEkHfb1~heMCJA3Uycrg target=_blank><img src=https://iceberg.apache.org/docs/latest/img/Slack_Mark_Web.png target=_blank class=top-external-icon></a></div><ul><li class=book-section-flats><span><i class="fa fa-table fa-fw"></i>
Tables</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/configuration/>Configuration</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/evolution/>Evolution</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/maintenance/>Maintenance</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/partitioning/>Partitioning</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/performance/>Performance</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/reliability/ class=active>Reliability</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/schemas/>Schemas</a></li></ul></li><li class=book-section-flats><span><i class="fa fa-star-o fa-fw"></i>
Spark</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/getting-started/>Getting Started</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-configuration/>Configuration</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-ddl/>DDL</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-procedures/>Procedures</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-queries/>Queries</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-structured-streaming/>Structured Streaming</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/spark-writes/>Writes</a></li></ul></li><li class=book-section-flats><span><img src=https://iceberg.apache.org/docs/latest/img/flink-logo.png class="navigation-icon fa-fw">Flink</span><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/flink/>Getting Started</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/flink-connector/>Flink Connector</a></li></ul></li><li class=book-section-flats><a href=https://iceberg.apache.org/docs/latest/hive/><img src=https://iceberg.apache.org/docs/latest/img/../img/hive-logo.png class="navigation-icon fa-fw">Hive</a><ul></ul></li><li><a href=https://trino.io/docs/current/connector/iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/trino-logo.png class="navigation-icon fa-fw">
Trino</a></li><li><a href=https://prestodb.io/docs/current/connector/iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/prestodb-logo.png class="navigation-icon fa-fw">
Presto</a></li><li><a href=https://docs.dremio.com/data-formats/apache-iceberg/ target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/dremio-logo.png class="navigation-icon fa-fw">
Dremio</a></li><li><a href=https://docs.starrocks.com/en-us/main/using_starrocks/External_table#apache-iceberg-external-table target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/starrocks-logo.png class="navigation-icon fa-fw">
StarRocks</a></li><li><a href=https://docs.aws.amazon.com/athena/latest/ug/querying-iceberg.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/athena-logo.png class="navigation-icon fa-fw">
Amazon Athena</a></li><li><a href=https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-iceberg-use-cluster.html target=_blank><img src=https://iceberg.apache.org/docs/latest/img/../img/emr-logo.png class="navigation-icon fa-fw">
Amazon EMR</a></li><li class=book-section-collapsed><input type=checkbox id=section-56605d8e971a871885e28ee5142728bf class=toggle>
<label for=section-56605d8e971a871885e28ee5142728bf class="flex justify-between"><a role=button><i class="fa fa-handshake-o fa-fw"></i>
Integrations</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/aws/>AWS</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/jdbc/>JDBC</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/nessie/>Nessie</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-bf7b3283e3790c00c8caaa140299052b class=toggle>
<label for=section-bf7b3283e3790c00c8caaa140299052b class="flex justify-between"><a role=button><i class="fa fa-connectdevelop fa-fw"></i>
API</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/java-api-quickstart/>Java Quickstart</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/api/>Java API</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/custom-catalog/>Java Custom Catalog</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../javadoc/latest>Javadocs</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/python-quickstart/>Python Quickstart</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/python-api-intro/>Python API</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/python-feature-support/>Python Feature Support</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-7e66f1754ca5d93e20ecdc89df5b8b28 class=toggle>
<label for=section-7e66f1754ca5d93e20ecdc89df5b8b28 class="flex justify-between"><a role=button><i class="fa fa-users fa-fw"></i>
Community</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../community>Join</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../blogs>Blogs</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../talks>Talks</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../contribute>Contribute</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-87dda23e9104fe3231cee3bc88a2d754 class=toggle>
<label for=section-87dda23e9104fe3231cee3bc88a2d754 class="flex justify-between"><a role=button><i class="fa fa-object-ungroup fa-fw"></i>
Format</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../spec>Spec</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../terms>Terms</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../view-spec>View Spec</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-2e5d3f5f142758d8dd368e9c281dd08e class=toggle>
<label for=section-2e5d3f5f142758d8dd368e9c281dd08e class="flex justify-between"><a role=button><i class="fa fa-wrench fa-fw"></i>
Project</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../how-to-release>How to Release</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../how-to-verify-a-release>How to Release</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../multi-engine-support>Multi-Engine Support</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../roadmap>Roadmap</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../security>Security</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../trademarks>Trademarks</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-4ddb27a8612bc8118c0b36386905d332 class=toggle>
<label for=section-4ddb27a8612bc8118c0b36386905d332 class="flex justify-between"><a role=button><i class="fa fa-code-fork fa-fw"></i>
Releases</a></label><ul><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../latest>Latest</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.13.2>0.13.2</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.13.1>0.13.1</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.13.0>0.13.0</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../0.12.1>0.12.1</a></li><li class=navigation-icon-pad><a href=https://iceberg.apache.org/docs/latest/../../../releases>Release Notes</a></li></ul></li><li class=book-section-collapsed><input type=checkbox id=section-296746d27808aa768e500824aaf2adea class=toggle>
<label for=section-296746d27808aa768e500824aaf2adea class="flex justify-between"><a role=button><img src=https://iceberg.apache.org/docs/latest/img/../img/asf.png class="navigation-icon fa-fw">ASF</a></label><ul><li class=navigation-icon-pad><a href=https://www.apache.org/licenses/ target=_blank><i class="fa fa-external-link fa-fw"></i>
License</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/security/ target=_blank><i class="fa fa-external-link fa-fw"></i>
Security</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/foundation/thanks.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Sponsors</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/foundation/sponsorship.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Donate</a></li><li class=navigation-icon-pad><a href=https://www.apache.org/events/current-event.html target=_blank><i class="fa fa-external-link fa-fw"></i>
Events</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/></div><div><ul id=book-search-results><li id=liFirst style=background-color:#0000;border-bottom:#0000;color:#0000>.</li></ul></div></br><header class=book-header><div class="flex align-center justify-between"><link rel=stylesheet href=/docs/latest/fontawesome/css/font-awesome.min.css><label for=menu-control><img src=/docs/latest/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Reliability</strong>
<label for=toc-control><img src=/docs/latest/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#concurrent-write-operations>Concurrent write operations</a><ul><li><a href=#cost-of-retries>Cost of retries</a></li><li><a href=#retry-validation>Retry validation</a></li></ul></li><li><a href=#compatibility>Compatibility</a></li></ul></nav></aside></header><article class=markdown><h1 id=reliability>Reliability
<a class=anchor href=#reliability>#</a></h1><p>Iceberg was designed to solve correctness problems that affect Hive tables running in S3.</p><p>Hive tables track data files using both a central metastore for partitions and a file system for individual files. This makes atomic changes to a table&rsquo;s contents impossible, and eventually consistent stores like S3 may return incorrect results due to the use of listing files to reconstruct the state of a table. It also requires job planning to make many slow listing calls: O(n) with the number of partitions.</p><p>Iceberg tracks the complete list of data files in each <a href=../../../terms#snapshot>snapshot</a> using a persistent tree structure. Every write or delete produces a new snapshot that reuses as much of the previous snapshot&rsquo;s metadata tree as possible to avoid high write volumes.</p><p>Valid snapshots in an Iceberg table are stored in the table metadata file, along with a reference to the current snapshot. Commits replace the path of the current table metadata file using an atomic operation. This ensures that all updates to table data and metadata are atomic, and is the basis for <a href=https://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Serializable>serializable isolation</a>.</p><p>This results in improved reliability guarantees:</p><ul><li><strong>Serializable isolation</strong>: All table changes occur in a linear history of atomic table updates</li><li><strong>Reliable reads</strong>: Readers always use a consistent snapshot of the table without holding a lock</li><li><strong>Version history and rollback</strong>: Table snapshots are kept as history and tables can roll back if a job produces bad data</li><li><strong>Safe file-level operations</strong>. By supporting atomic changes, Iceberg enables new use cases, like safely compacting small files and safely appending late data to tables</li></ul><p>This design also has performance benefits:</p><ul><li><strong>O(1) RPCs to plan</strong>: Instead of listing O(n) directories in a table to plan a job, reading a snapshot requires O(1) RPC calls</li><li><strong>Distributed planning</strong>: File pruning and predicate push-down is distributed to jobs, removing the metastore as a bottleneck</li><li><strong>Finer granularity partitioning</strong>: Distributed planning and O(1) RPC calls remove the current barriers to finer-grained partitioning</li></ul><h2 id=concurrent-write-operations>Concurrent write operations
<a class=anchor href=#concurrent-write-operations>#</a></h2><p>Iceberg supports multiple concurrent writes using optimistic concurrency.</p><p>Each writer assumes that no other writers are operating and writes out new table metadata for an operation. Then, the writer attempts to commit by atomically swapping the new table metadata file for the existing metadata file.</p><p>If the atomic swap fails because another writer has committed, the failed writer retries by writing a new metadata tree based on the the new current table state.</p><h3 id=cost-of-retries>Cost of retries
<a class=anchor href=#cost-of-retries>#</a></h3><p>Writers avoid expensive retry operations by structuring changes so that work can be reused across retries.</p><p>For example, appends usually create a new manifest file for the appended data files, which can be added to the table without rewriting the manifest on every attempt.</p><h3 id=retry-validation>Retry validation
<a class=anchor href=#retry-validation>#</a></h3><p>Commits are structured as assumptions and actions. After a conflict, a writer checks that the assumptions are met by the current table state. If the assumptions are met, then it is safe to re-apply the actions and commit.</p><p>For example, a compaction might rewrite <code>file_a.avro</code> and <code>file_b.avro</code> as <code>merged.parquet</code>. This is safe to commit as long as the table still contains both <code>file_a.avro</code> and <code>file_b.avro</code>. If either file was deleted by a conflicting commit, then the operation must fail. Otherwise, it is safe to remove the source files and add the merged file.</p><h2 id=compatibility>Compatibility
<a class=anchor href=#compatibility>#</a></h2><p>By avoiding file listing and rename operations, Iceberg tables are compatible with any object store. No consistent listing is required.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#concurrent-write-operations>Concurrent write operations</a><ul><li><a href=#cost-of-retries>Cost of retries</a></li><li><a href=#retry-validation>Retry validation</a></li></ul></li><li><a href=#compatibility>Compatibility</a></li></ul></nav></div></aside></main></body></html>